# Задание

2.1 У вас локальная сеть, в которой есть 
- DMZ, в которой находится 360 виртуальных машин. в числе прочего, веб-сервер 192.168.3.0:80, к которому обращаются пользователи из интернета
- 200 обычных пользователей, которым нужен доступ в интернет. Из этой сети должны быть разрешены ssh-соединения к виртуалкам из DMZ.
- 12 компьютеров финансистов, которым нужен доступ к принтерам и в интернет, к которым не должны подключаться другие пользователи.
- 5 принтеров, к которым должны иметь доступ все пользователи  
а) Выделите минимально необходимые сети ipv4  
б) опишите как бы вы с помощью маршрутизатора на базе Linux настроили фаерволл и организовали доступ в интернет для внутренних пользователей и доступ к веб-серверу из интернета


# Решение 

| № | IP-адрес и маска | Диапазон IP-адресов | Шлюз | Широковещательный запрос | Количество узлов в сети (без шлюза) | Пояснение |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1 | 192.168.2.0/23 | 192.168.2.1 - 192.168.3.254 | 192.168.2.1 | 192.168.3.255 | 509 | DMZ, в которой находится 360 виртуальных машин, веб-сервер 192.168.3.0 | 
| 2 | 192.168.4.0/24 | 192.168.4.1 - 192.168.4.254 | 192.168.4.1 | 192.168.4.255 | 253 | 200 обычных пользователей | 
| 3 | 192.168.5.0/28 | 192.168.5.1 - 192.168.5.14 | 192.168.5.1 | 192.168.5.15 | 13 | 12 компьютеров финансистов |
| 4 | 192.168.5.16/29 | 192.168.5.17 - 192.168.5.22 | 192.168.5.17 | 192.168.5.23 | 5 | 5 принтеров | 

Пример настройки файрвола на маршрутизаторе Cisco на базе ACL (описал только часть конфигурации, которые касаются только таблицы маршрутизации между подсетями)

interface ethernet 1.2
enable
ip address 192.168.2.1/23
ip access-group dmz in
ip access-group dmz out
!
interface ethernet 1.3
enable
ip address 192.168.4.1/24
ip access-group users in
ip access-group users out
!
interface ethernet 1.4
enable
ip address 192.168.5.1/28
ip access-group finacial in
ip access-group finacial out
!
interface ethernet 1.5
enable
ip address 192.168.5.17/29
ip access-group printers in
ip access-group printers out
!
ip route 192.168.2.0/23 192.168.4.1
ip route 192.168.4.0/24 192.168.2.1
ip route 192.168.5.0/28 192.168.5.17
ip route 192.168.5.16/29 192.168.5.1
ip route 192.168.4.0/24 192.168.5.17
ip route 192.168.5.16/29 192.168.4.1
!
ip access-list dmz in
permit tcp 192.168.3.0 0.0.0.0 eq 80
permit tcp 192.168.3.0 0.0.0.0 eq 443
permit tcp 192.168.2.0/23 192.168.4.0/24 eq 22
deny
!
ip access-list dmz out
permit tcp 0.0.0.0 192.168.3.0 eq 80
permit tcp 0.0.0.0 192.168.3.0 eq 443
permit tcp 192.168.4.0/24 192.168.2.0/23 eq 22
deny
!
ip access-list users in
permit 192.168.4.0/24 192.168.5.16/29 eq 137
permit 192.168.4.0/24 192.168.5.16/29 eq 138
permit 192.168.4.0/24 192.168.5.16/29 eq 139
permit tcp 192.168.4.0/24 192.168.2.0/23 eq 22
deny
!
ip access-list users out
permit 192.168.5.16/29 192.168.4.0/24 eq 137
permit 192.168.5.16/29 192.168.4.0/24 eq 138
permit 192.168.5.16/29 192.168.4.0/24 eq 139
permit tcp 192.168.2.0/23 192.168.4.0/24 eq 22
deny
!
ip access-list finacial in
permit 192.168.5.0/28 192.168.5.16/29 eq 137
permit 192.168.5.0/28 192.168.5.16/29 eq 138
permit 192.168.5.0/28 192.168.5.16/29 eq 139
deny
!
ip access-list finacial out
permit 192.168.5.16/29 192.168.5.0/28 eq 137
permit 192.168.5.16/29 192.168.5.0/28 eq 138
permit 192.168.5.16/29 192.168.5.0/28 eq 139
deny
!
ip access-list printers in
permit 192.168.5.16/29 192.168.5.0/28 eq 137
permit 192.168.5.16/29 192.168.5.0/28 eq 138
permit 192.168.5.16/29 192.168.5.0/28 eq 139
permit 192.168.5.16/29 192.168.4.0/24 eq 137
permit 192.168.5.16/29 192.168.4.0/24 eq 138
permit 192.168.5.16/29 192.168.4.0/24 eq 139
deny
!
ip access-list printers out
permit 192.168.5.0/28 192.168.5.16/29 eq 137
permit 192.168.5.0/28 192.168.5.16/29 eq 138
permit 192.168.5.0/28 192.168.5.16/29 eq 139
permit 192.168.4.0/24 192.168.5.16/29 eq 137
permit 192.168.4.0/24 192.168.5.16/29 eq 138
permit 192.168.4.0/24 192.168.5.16/29 eq 139
deny
!

Настройки для проброса в интернет
В качестве белого ip-адреса буду использовать 83.220.32.68

Router(config)# ip nat inside source static 192.168.4.0/24 83.220.32.68
Router(config)# ip nat inside source static 192.168.5.0/28 83.220.32.68
Router(config)# ip nat inside source static 192.168.3.0 83.220.32.68
Router(config)# interface ethernet 0
Router(config)# enable
Router(config)# ip nat inside
Router(config)# ip nat outside





